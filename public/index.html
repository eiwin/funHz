<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>è¶£å­¦æ±‰å­— | Fun Chinese</title>
    <link rel="stylesheet" href="/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <!-- æˆå°±æç¤º -->
    <div class="achievement" id="achievement">
        <div class="achievement-icon">ğŸ†</div>
        <div class="achievement-text">ä½ çœŸæ£’ï¼å­¦ä¼šäº†æ–°æ±‰å­—ï¼</div>
    </div>
    
    <!-- å‰ç¥¥ç‰© -->
    <div class="mascot" id="mascot">ğŸ¼</div>
    
    <div class="container cartoon-border">
        <header>
            <h1>è¶£å­¦æ±‰å­— <span class="subtitle">Fun Chinese</span></h1>
            
            <div class="progress-container">
                <div class="progress-bar" id="progressBar" style="width: 30%;"></div>
            </div>
            
            <div class="stars">
                <div class="star filled">â­</div>
                <div class="star filled">â­</div>
                <div class="star">â­</div>
                <div class="star">â­</div>
                <div class="star">â­</div>
            </div>
            
            <div class="category-tabs">
                <button class="tab-btn active" onclick="switchCategory('all')">å…¨éƒ¨ <span class="en-text">All</span></button>
                <button class="tab-btn" onclick="switchCategory('basic')">åŸºç¡€å­— <span class="en-text">Basic</span></button>
                <button class="tab-btn" onclick="switchCategory('nature')">è‡ªç„¶ <span class="en-text">Nature</span></button>
                <button class="tab-btn" onclick="switchCategory('numbers')">æ•°å­— <span class="en-text">Numbers</span></button>
                <button class="tab-btn" onclick="switchCategory('actions')">åŠ¨ä½œ <span class="en-text">Actions</span></button>
                <button class="tab-btn" onclick="switchCategory('family')">å®¶åº­ <span class="en-text">Family</span></button>
            </div>
            
            <div class="search-box">
                <input type="text" id="charSearch" placeholder="æœç´¢æ±‰å­—... / Search characters...">
                <div class="level-filter">
                    <select id="levelSelect">
                        <option value="all">æ‰€æœ‰éš¾åº¦ / All Levels</option>
                        <option value="1">ç®€å• / Easy</option>
                        <option value="2">è¿›é˜¶ / Advanced</option>
                    </select>
                </div>
            </div>
        </header>

        <div class="character-list">
            <div class="available-chars"></div>
            <div class="pagination">
                <button onclick="changePage('prev')">ä¸Šä¸€é¡µ <span class="en-text">Prev</span></button>
                <span id="pageInfo">ç¬¬ 1 é¡µ / å…± 1 é¡µ</span>
                <button onclick="changePage('next')">ä¸‹ä¸€é¡µ <span class="en-text">Next</span></button>
            </div>
        </div>

        <main>
            <section class="character-display">
                <div class="main-character"></div>
                <div class="english"></div>
                
                <div class="game-controls">
                    <button class="game-btn" onclick="practiceWriting()">ç»ƒä¹ å†™å­— <span class="en-text">Practice Writing</span></button>
                    <button class="game-btn" onclick="playGame()">è¶£å‘³æ¸¸æˆ <span class="en-text">Fun Game</span></button>
                </div>
            </section>

            <section class="words-section">
                <h2>è¯è¯­ / Words</h2>
                <div class="word-items-grid"></div>
            </section>

            <section class="sentences-section">
                <h2>ä¾‹å¥ / Example Sentences</h2>
            </section>

            <section class="fun-facts">
                <h2>è¶£å‘³è§£é‡Š / Fun Facts</h2>
                <div class="fun-fact-item">
                    <div class="chinese"></div>
                    <div class="english"></div>
                </div>
            </section>
            
            <!-- å†™å­—ç»ƒä¹ åŒºåŸŸ -->
            <section class="writing-practice" id="writingPractice" style="display: none;">
                <h2>å†™å­—ç»ƒä¹  / Writing Practice</h2>
                <div class="writing-container">
                    <canvas id="writingCanvas" width="300" height="300"></canvas>
                    <div class="score-display">
                        <div class="score-label">åˆ† / Score</div>
                        <div class="score-value">0</div>
                    </div>
                    <div class="writing-controls">
                        <button class="game-btn" onclick="clearCanvas()">æ¸…é™¤ <span class="en-text">Clear</span></button>
                        <button class="game-btn" onclick="checkWriting()">æ£€æŸ¥ <span class="en-text">Check</span></button>
                    </div>
                </div>
            </section>
            
            <!-- è¶£å‘³æ¸¸æˆåŒºåŸŸ -->
            <section class="mini-game" id="miniGame" style="display: none;">
                <h2>è¶£å‘³æ¸¸æˆ / Fun Game</h2>
                <div class="game-container">
                    <div class="game-instruction">é€‰æ‹©æ­£ç¡®çš„æ‹¼éŸ³! <span class="en-text">Choose the correct pinyin!</span></div>
                    <div class="game-options">
                        <button class="game-option">é€‰é¡¹1</button>
                        <button class="game-option">é€‰é¡¹2</button>
                        <button class="game-option">é€‰é¡¹3</button>
                    </div>
                    <div class="game-result"></div>
                </div>
            </section>
        </main>
        
        <footer>
            <p>Â© 2025 è¶£å­¦æ±‰å­— | Fun Chinese Learning</p>
        </footer>
    </div>
    
    <script src="/script.js"></script>
    
    <script>
        // å‰ç¥¥ç‰©äº¤äº’
        document.getElementById('mascot').addEventListener('click', function() {
            this.textContent = ['ğŸ¼', 'ğŸ¯', 'ğŸ¶', 'ğŸ±', 'ğŸ°'][Math.floor(Math.random() * 5)];
            this.classList.add('bounce');
            setTimeout(() => this.classList.remove('bounce'), 1000);
            
            // æ˜¾ç¤ºéšæœºé¼“åŠ±è¯­
            const encouragements = [
                {zh: 'åŠ æ²¹ï¼ä½ çœŸæ£’ï¼', en: 'Great job!'},
                {zh: 'ç»§ç»­å­¦ä¹ ï¼', en: 'Keep learning!'},
                {zh: 'ä½ å­¦å¾—çœŸå¿«ï¼', en: 'You learn so fast!'},
                {zh: 'å¤ªå‰å®³äº†ï¼', en: 'Amazing!'},
                {zh: 'ä½ æ˜¯æœ€æ£’çš„ï¼', en: 'You are the best!'}
            ];
            const selected = encouragements[Math.floor(Math.random() * encouragements.length)];
            showAchievement('ğŸ‰', `${selected.zh} (${selected.en})`);
        });
        
        // æ˜¾ç¤ºæˆå°±
        function showAchievement(icon, text) {
            const achievement = document.getElementById('achievement');
            achievement.querySelector('.achievement-icon').textContent = icon;
            achievement.querySelector('.achievement-text').textContent = text;
            achievement.classList.add('show');
            
            setTimeout(() => {
                achievement.classList.remove('show');
            }, 3000);
        }
        
        // å†™å­—ç»ƒä¹ 
        function practiceWriting() {
            const writingSection = document.getElementById('writingPractice');
            const gameSection = document.getElementById('miniGame');
            
            writingSection.style.display = 'block';
            gameSection.style.display = 'none';
            
            initCanvas();
            
            // æ»šåŠ¨åˆ°å†™å­—åŒºåŸŸ
            writingSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        function initCanvas() {
            const canvas = document.getElementById('writingCanvas');
            const ctx = canvas.getContext('2d');
            
            // æ¸…é™¤ç”»å¸ƒ
            ctx.fillStyle = '#f9f9f9';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶ç½‘æ ¼
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            
            // æ¨ªçº¿
            for (let i = 0; i <= canvas.height; i += 30) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }
            
            // ç«–çº¿
            for (let i = 0; i <= canvas.width; i += 30) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            
            // æ·»åŠ å½“å‰æ±‰å­—æ°´å° - åªæ˜¾ç¤ºæ±‰å­—ï¼Œä¸æ˜¾ç¤ºæ‹¼éŸ³
            const mainCharElement = document.querySelector('.main-character ruby');
            if (mainCharElement) {
                // åªè·å–æ±‰å­—ï¼Œä¸åŒ…æ‹¬æ‹¼éŸ³
                const currentChar = mainCharElement.textContent.trim().charAt(0);
                
                ctx.font = '150px sans-serif';
                ctx.fillStyle = 'rgba(200, 200, 200, 0.2)';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(currentChar, canvas.width/2, canvas.height/2);
            }
            
            // è®¾ç½®ç»˜å›¾çŠ¶æ€
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            
            // é¼ æ ‡/è§¦æ‘¸äº‹ä»¶
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // è§¦æ‘¸æ”¯æŒ
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
            
            function startDrawing(e) {
                isDrawing = true;
                [lastX, lastY] = [e.offsetX, e.offsetY];
            }
            
            function draw(e) {
                if (!isDrawing) return;
                
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 8;
                ctx.lineCap = 'round';
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(e.offsetX, e.offsetY);
                ctx.stroke();
                
                [lastX, lastY] = [e.offsetX, e.offsetY];
            }
            
            function stopDrawing() {
                isDrawing = false;
            }
            
            function handleTouch(e) {
                e.preventDefault();
                
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const offsetX = touch.clientX - rect.left;
                const offsetY = touch.clientY - rect.top;
                
                const mouseEvent = new MouseEvent(
                    e.type === 'touchstart' ? 'mousedown' : 'mousemove',
                    {
                        clientX: touch.clientX,
                        clientY: touch.clientY
                    }
                );
                
                mouseEvent.offsetX = offsetX;
                mouseEvent.offsetY = offsetY;
                
                if (e.type === 'touchstart') {
                    startDrawing(mouseEvent);
                } else {
                    draw(mouseEvent);
                }
            }
        }
        
        function clearCanvas() {
            initCanvas();
        }
        
        function checkWriting() {
            const canvas = document.getElementById('writingCanvas');
            const ctx = canvas.getContext('2d');
            
            // è·å–ç”»å¸ƒæ•°æ®
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            // è®¡ç®—åƒç´ è¦†ç›–ç‡
            let pixelCount = 0;
            for (let i = 0; i < data.length; i += 4) {
                // æ£€æŸ¥éç™½è‰²åƒç´  (RGBå€¼ä¸å…¨ä¸º255æˆ–æ¥è¿‘255)
                if (data[i] < 240 || data[i+1] < 240 || data[i+2] < 240) {
                    pixelCount++;
                }
            }
            
            // è®¡ç®—è¦†ç›–ç‡ç™¾åˆ†æ¯”
            const totalPixels = canvas.width * canvas.height;
            const coverage = pixelCount / totalPixels;
            
            // è®¡ç®—åˆ†æ•° (0-100)
            // ç†æƒ³è¦†ç›–ç‡åœ¨5%-15%ä¹‹é—´ï¼Œè¿‡å¤šæˆ–è¿‡å°‘éƒ½ä¼šæ‰£åˆ†
            let score = 0;
            if (coverage < 0.01) {
                // å‡ ä¹æ²¡å†™
                score = 0;
            } else if (coverage > 0.30) {
                // å†™å¤ªå¤šäº†
                score = Math.max(0, 100 - (coverage - 0.30) * 1000);
            } else {
                // æ­£å¸¸èŒƒå›´å†…ï¼Œæ ¹æ®è¦†ç›–ç‡ç»™åˆ†
                // æœ€ä½³è¦†ç›–ç‡çº¦ä¸º0.10 (10%)
                const idealCoverage = 0.10;
                const deviation = Math.abs(coverage - idealCoverage);
                score = Math.max(0, 100 - deviation * 500);
            }
            
            // å››èˆäº”å…¥åˆ°æ•´æ•°
            score = Math.round(score);
            
            // æ˜¾ç¤ºåˆ†æ•°
            const scoreElement = document.querySelector('.score-value') || document.createElement('div');
            if (!document.querySelector('.score-value')) {
                scoreElement.className = 'score-value';
                document.querySelector('.writing-container').appendChild(scoreElement);
            }
            scoreElement.textContent = score;
            scoreElement.classList.add('score-animation');
            
            // æ ¹æ®åˆ†æ•°æ˜¾ç¤ºä¸åŒçš„åé¦ˆ
            let feedbackMessage = '';
            let icon = '';
            
            if (score >= 90) {
                feedbackMessage = 'å†™å¾—å¤ªæ£’äº†ï¼å®Œç¾ï¼ (Excellent writing! Perfect!)';
                icon = 'ğŸ†';
            } else if (score >= 70) {
                feedbackMessage = 'å†™å¾—å¾ˆå¥½ï¼ç»§ç»­ç»ƒä¹ ï¼ (Great writing! Keep practicing!)';
                icon = 'ğŸ‘';
            } else if (score >= 50) {
                feedbackMessage = 'ä¸é”™çš„å°è¯•ï¼å†ç»ƒä¹ ä¸€ä¸‹ï¼ (Good try! Practice more!)';
                icon = 'ğŸ‘Œ';
            } else {
                feedbackMessage = 'ç»§ç»­åŠªåŠ›ï¼æ…¢æ…¢æ¥ï¼ (Keep trying! Take it slow!)';
                icon = 'ğŸ’ª';
            }
            
            // æ˜¾ç¤ºæˆå°±
            showAchievement(icon, feedbackMessage);
            
            // å¢åŠ è¿›åº¦
            const progressBar = document.getElementById('progressBar');
            const currentWidth = parseInt(progressBar.style.width);
            const progressIncrease = Math.max(5, Math.floor(score / 10)); // æ ¹æ®åˆ†æ•°å¢åŠ è¿›åº¦
            progressBar.style.width = Math.min(currentWidth + progressIncrease, 100) + '%';
            
            // å¦‚æœè¿›åº¦è¾¾åˆ°100%ï¼Œæ·»åŠ æ˜Ÿæ˜Ÿ
            if (currentWidth + progressIncrease >= 100) {
                const stars = document.querySelectorAll('.star:not(.filled)');
                if (stars.length > 0) {
                    stars[0].classList.add('filled');
                    showAchievement('ğŸŒŸ', 'æ­å–œè·å¾—ä¸€é¢—æ˜Ÿæ˜Ÿï¼(Congratulations on earning a star!)');
                }
                progressBar.style.width = '0%';
            }
            
            // æ·»åŠ CSSæ ·å¼
            if (!document.getElementById('score-styles')) {
                const style = document.createElement('style');
                style.id = 'score-styles';
                style.textContent = `
                    .score-value {
                        font-size: 3rem;
                        font-weight: bold;
                        color: var(--primary);
                        text-align: center;
                        margin: 10px 0;
                        position: relative;
                    }
                    
                    .score-animation {
                        animation: pulse 1s ease-in-out;
                    }
                    
                    @keyframes pulse {
                        0% { transform: scale(1); }
                        50% { transform: scale(1.5); }
                        100% { transform: scale(1); }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        // è¶£å‘³æ¸¸æˆ
        function playGame() {
            const writingSection = document.getElementById('writingPractice');
            const gameSection = document.getElementById('miniGame');
            
            writingSection.style.display = 'none';
            gameSection.style.display = 'block';
            
            // è®¾ç½®æ¸¸æˆ
            setupPinyinGame();
            
            // æ»šåŠ¨åˆ°æ¸¸æˆåŒºåŸŸ
            gameSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        function setupPinyinGame() {
            const currentChar = document.querySelector('.main-character ruby').textContent.trim();
            const correctPinyin = document.querySelector('.main-character rt').textContent.trim();
            
            // ç”Ÿæˆé”™è¯¯é€‰é¡¹
            const pinyinOptions = [correctPinyin];
            const allPinyins = ['shÅ«', 'shÃº', 'shÇ”', 'shÃ¹', 'hÃ n', 'zÃ¬', 'xuÃ©', 'xÃ­'];
            
            while (pinyinOptions.length < 3) {
                const randomPinyin = allPinyins[Math.floor(Math.random() * allPinyins.length)];
                if (!pinyinOptions.includes(randomPinyin)) {
                    pinyinOptions.push(randomPinyin);
                }
            }
            
            // æ‰“ä¹±é€‰é¡¹é¡ºåº
            pinyinOptions.sort(() => Math.random() - 0.5);
            
            // æ›´æ–°æ¸¸æˆç•Œé¢
            document.querySelector('.game-instruction').innerHTML = `é€‰æ‹© "${currentChar}" çš„æ­£ç¡®æ‹¼éŸ³: <span class="en-text">Choose the correct pinyin for "${currentChar}":</span>`;
            
            const optionButtons = document.querySelectorAll('.game-option');
            optionButtons.forEach((button, index) => {
                button.textContent = pinyinOptions[index];
                button.onclick = function() {
                    checkAnswer(this.textContent, correctPinyin);
                };
            });
            
            document.querySelector('.game-result').textContent = '';
        }
        
        function checkAnswer(selected, correct) {
            const resultElement = document.querySelector('.game-result');
            
            if (selected === correct) {
                resultElement.innerHTML = 'æ­£ç¡®! ğŸ‘ <span class="en-text">Correct!</span>';
                resultElement.style.color = 'green';
                
                showAchievement('ğŸ®', 'æ¸¸æˆèƒœåˆ©ï¼(Game won!)');
                
                // å¢åŠ è¿›åº¦
                const progressBar = document.getElementById('progressBar');
                const currentWidth = parseInt(progressBar.style.width);
                progressBar.style.width = Math.min(currentWidth + 15, 100) + '%';
                
                // å¦‚æœè¿›åº¦è¾¾åˆ°100%ï¼Œæ·»åŠ æ˜Ÿæ˜Ÿ
                if (currentWidth + 15 >= 100) {
                    const stars = document.querySelectorAll('.star:not(.filled)');
                    if (stars.length > 0) {
                        stars[0].classList.add('filled');
                        showAchievement('ğŸŒŸ', 'æ­å–œè·å¾—ä¸€é¢—æ˜Ÿæ˜Ÿï¼(Congratulations on earning a star!)');
                    }
                    progressBar.style.width = '0%';
                }
                
                // 3ç§’åè®¾ç½®æ–°æ¸¸æˆ
                setTimeout(setupPinyinGame, 2000);
            } else {
                resultElement.innerHTML = `é”™è¯¯! æ­£ç¡®ç­”æ¡ˆæ˜¯: ${correct} <span class="en-text">Wrong! The correct answer is: ${correct}</span>`;
                resultElement.style.color = 'red';
            }
        }
        
        // é¡µé¢åŠ è½½åŠ¨ç”»
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('section').forEach(section => {
                section.classList.add('fade-in');
            });
        });
    </script>
</body>
</html> 